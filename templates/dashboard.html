{% extends "base.html" %}

{% block title %}Dashboard - Nexar{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/modern-dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Navigation Tabs -->
    <div class="dashboard-nav-tabs">
        <a href="#" class="dashboard-nav-link active">Dashboard</a>
        <a href="{{ url_for('leave_request') }}" class="dashboard-nav-link">Leave</a>
        <a href="{{ url_for('attendance_list_view') }}" class="dashboard-nav-link">Attendance</a>
        <a href="#" class="dashboard-nav-link">Calendar</a>
        {% if current_user.role.name == 'Manager' or current_user.role.name == 'Admin' %}
        <a href="#" class="dashboard-nav-link">Team</a>
        {% endif %}
    </div>

    <!-- Main Grid -->
    <div class="dashboard-grid">
        <!-- Column 1: Profile & Announcements -->
        <div class="grid-col-1 d-flex flex-column gap-3">
            <!-- Profile Card -->
            <div class="dash-card profile-card">
                <div class="dash-card-header">
                    <span>My Profile</span>
                    <i class="fas fa-id-badge"></i>
                </div>
                <div class="profile-card-content">
                    <div class="profile-info-row">
                        <div class="profile-avatar">
                            {% if current_user.employee_profile and current_user.employee_profile.profile_image_path %}
                            <img src="{{ url_for('static', filename=current_user.employee_profile.profile_image_path) }}"
                                alt="Profile">
                            {% else %}
                            <i class="fas fa-user"></i>
                            {% endif %}
                        </div>
                        <div class="profile-details">
                            <h4>{{ current_user.full_name }}</h4>
                            <p>{{ current_user.employee_profile.designation.name if current_user.employee_profile and
                                current_user.employee_profile.designation else current_user.role.name }}</p>

                            {% if current_user.employee_profile %}
                            <div class="profile-meta">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>{{ current_user.employee_profile.location or 'Main Office' }}</span>
                            </div>
                            <div class="profile-meta">
                                <i class="fas fa-phone"></i>
                                <span>{{ current_user.employee_profile.phone or 'No phone number' }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Announcements Card -->
            <div class="dash-card">
                <div class="dash-card-header">
                    <span>Announcements</span>
                    <i class="fas fa-bullhorn"></i>
                </div>
                <div class="empty-state">
                    No Announcement
                </div>
            </div>
        </div>

        <!-- Column 2: Favorites & Leave Report -->
        <div class="grid-col-2 d-flex flex-column gap-3">
            <!-- Favorites Card -->
            <div class="dash-card" style="min-height: 200px;">
                <div class="dash-card-header">
                    <span>Favorites</span>
                    <i class="fas fa-star"></i>
                </div>
                <div class="empty-state">
                    No Favorites found.
                </div>
            </div>

            <!-- Leave Report Card -->
            <div class="dash-card">
                <div class="dash-card-header">
                    <span>Leave Report</span>
                    <i class="fas fa-chart-pie"></i>
                </div>
                <div class="d-flex flex-column">
                    <div class="stat-row">
                        <span class="stat-label">Annual Leave</span>
                        <span class="stat-value">{{ stats.annual_leave_balance|int }} Days</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Sick Leave</span>
                        <span class="stat-value">{{ stats.sick_leave_balance|int }} Days</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Comp Off</span>
                        <span class="stat-value">{{ stats.comp_off_balance|int }} Days</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Absent</span>
                        <span class="stat-value">{{ stats.absent_days if stats.absent_days is defined else 0 }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Column 3: Quick Links & Holidays -->
        <div class="grid-col-3 d-flex flex-column gap-3">
            <!-- Quick Links Card -->
            <div class="dash-card" style="min-height: 200px;">
                <div class="dash-card-header">
                    <span>Quick Links</span>
                    <i class="fas fa-link"></i>
                </div>
                <div class="d-flex flex-wrap gap-2">
                    <a href="{{ url_for('documents_list') }}" class="btn-action">Payslips</a>
                    <a href="#" class="btn-action">Policies</a>
                    <a href="#" class="btn-action">Directory</a>
                </div>
            </div>

            <!-- Upcoming Holidays Card -->
            <div class="dash-card">
                <div class="dash-card-header">
                    <span>Upcoming Holidays</span>
                    <i class="fas fa-calendar-alt"></i>
                </div>
                {% if upcoming_holidays %}
                <div class="d-flex flex-column">
                    {% for holiday in upcoming_holidays %}
                    <div class="stat-row">
                        <span class="stat-label">{{ holiday.name }}</span>
                        <span class="holiday-badge">{{ holiday.date.strftime('%b %d') }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    No upcoming holidays
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Birthday Row (Optional full width or in a column) -->
        {% if upcoming_birthdays %}
        <div class="dash-card" style="grid-column: 1 / -1;">
            <div class="dash-card-header">
                <span>Upcoming Birthdays</span>
                <i class="fas fa-birthday-cake"></i>
            </div>
            <div class="d-flex gap-3 overflow-auto" style="padding-bottom: 0.5rem;">
                {% for bday in upcoming_birthdays %}
                <div class="d-flex align-items-center gap-3 p-3 border rounded-3 bg-white"
                    style="min-width: 260px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                    <div class="profile-avatar"
                        style="width: 48px; height: 48px; font-size: 1.2rem; background: rgba(46, 204, 113, 0.1); color: #2ecc71;">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <div style="font-weight: 600; font-size: 0.95rem; color: #333;">{{ bday.name }}</div>
                        <div style="font-size: 0.8rem; color: #777;">{{ bday.date.strftime('%d %b') }} â€¢ {{
                            bday.designation }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Quick Attendance -->
        <div class="dash-card" style="grid-column: 1 / -1;">
            <div class="dash-card-header">
                <span>Quick Attendance</span>
                <i class="fas fa-clock"></i>
            </div>
            <form method="POST" action="{{ url_for('attendance_mark') }}" id="attendance-form"
                class="d-flex gap-3 flex-wrap">
                <button type="submit" name="action" value="clock_in" class="btn-action btn-clock-in">
                    <i class="fas fa-sign-in-alt"></i> Clock In
                </button>
                <button type="submit" name="action" value="clock_out" class="btn-action btn-clock-out">
                    <i class="fas fa-sign-out-alt"></i> Clock Out
                </button>
                <button type="submit" name="action" value="break_start" class="btn-action btn-break">
                    <i class="fas fa-coffee"></i> Break Start
                </button>
                <button type="submit" name="action" value="break_end" class="btn-action btn-break">
                    <i class="fas fa-play"></i> Break End
                </button>
            </form>
            <!-- Recent Record Text -->
            {% if recent_attendance %}
            <div class="mt-3 text-muted small d-flex align-items-center gap-2">
                <i class="fas fa-history"></i>
                <span>
                    {% if recent_attendance.clock_out %}
                    Last: Clocked Out at {{ recent_attendance.clock_out.strftime('%I:%M %p') }}
                    {% elif recent_attendance.break_start and not recent_attendance.break_end %}
                    Status: On Break since {{ recent_attendance.break_start.strftime('%I:%M %p') }}
                    {% elif recent_attendance.clock_in %}
                    Status: Clocked In at {{ recent_attendance.clock_in.strftime('%I:%M %p') }}
                    {% else %}
                    No activity today
                    {% endif %}
                </span>
            </div>
            {% endif %}
        </div>

        <!-- Files Footer -->
        <div class="dashboard-footer">
            <div class="files-bar">
                <span style="font-weight: 600;">My Files</span>
                <span class="badge bg-light text-dark border">Total Files 0</span>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Dashboard scripts
    console.log('Modern Dashboard Loaded');
</script>
{% endblock %}