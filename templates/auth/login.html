{% extends "base.html" %}

{% block title %}Login - Nexar{% endblock %}

{% block head %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>{% endblock %}

{% block content %}
<section class="auth-wrapper">
    <div class="auth-shell">
        <!-- Login Form Only (No Illustration Panel) -->
        <div class="auth-form-panel">
            <div class="auth-form-container">
                <!-- Logo -->
                <div class="auth-logo">
                    <img src="{{ url_for('static', filename='img/nexar_icon.png') }}" alt="Nexar Logo" height="48">
                </div>

                <!-- Sign In Header -->
                <div class="auth-header">
                    <h1 class="auth-heading">Sign in</h1>
                    <p class="auth-subheading">to access Nexar HR Portal</p>
                </div>

                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                {% for category, message in messages %}
                {% if category == 'error' %}
                <div class="auth-alert auth-alert-error" role="alert">
                    <i class="fas fa-exclamation-circle"></i>
                    {{ message }}
                </div>
                {% endif %}
                {% endfor %}
                {% endif %}
                {% endwith %}

                <!-- Login Form -->
                <form method="POST" novalidate class="auth-form">
                    {{ form.hidden_tag() }}

                    <div class="auth-form-group">
                        {{ form.username.label(class="auth-form-label") }}
                        {{ form.username(class="auth-form-input", placeholder="Enter your username") }}
                        {% if form.username.errors %}
                        <div class="auth-form-error">
                            {% for error in form.username.errors %}
                            <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>

                    <div class="auth-form-group">
                        {{ form.password.label(class="auth-form-label") }}
                        {{ form.password(class="auth-form-input", placeholder="Enter your password") }}
                        {% if form.password.errors %}
                        <div class="auth-form-error">
                            {% for error in form.password.errors %}
                            <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>

                    <button type="submit" class="auth-submit-btn">
                        Sign In
                    </button>
                </form>

                <!-- Footer -->
                <div class="auth-footer">
                    <span>Need assistance?</span>
                    <a href="#" class="auth-footer-link">Contact support</a>
                </div>

                <!-- Dev Tools -->
                {% if environment == 'development' %}
                <div class="auth-dev-tools">
                    <form action="{{ url_for('dev.clean_db') }}" method="POST"
                        onsubmit="return confirm('WARNING: This will delete ALL HRM data and reset the database. Proceed?');">
                        <button type="submit" class="btn btn-outline-danger btn-sm w-100">
                            <i class="fas fa-trash-alt me-2"></i>Clean Database (Dev Only)
                        </button>
                    </form>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<script>
    // Auto-dismiss error alerts
    document.addEventListener('DOMContentLoaded', function () {
        const alerts = document.querySelectorAll('.auth-alert-error');
        alerts.forEach(alert => {
            setTimeout(() => {
                alert.style.animation = 'fadeOut 0.3s ease-in-out forwards';
                setTimeout(() => alert.remove(), 300);
            }, 5000);
        });
    });
</script>
{% endblock %}