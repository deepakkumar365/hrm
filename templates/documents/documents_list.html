{% extends "base.html" %}

{% block title %}My Documents - Nexar{% endblock %}

{% block head %}
<style>
    /* ===== Documents Page Theme ===== */
    :root {
        --primary-teal: #6C8F91;
        --light-teal: #A5C2C4;
        --navbar-teal: #7BA6AA;
        --blush-pink: #FBEFF1;
        --accent-teal: #C7E3E6;
        --brown-highlight: #8A4F24;
        --dark-text: #4A4A4A;
        --success-green: #75B798;
        --warning-yellow: #F4C542;
        --danger-red: #F4A5A5;
    }

    /* Page Background */
    body {
        background: linear-gradient(to bottom, #FBEFF1 0%, #FFFFFF 100%);
        min-height: 100vh;
    }

    .documents-container {
        padding: 2rem 0;
    }

    /* Header Styling */
    .documents-header {
        margin-bottom: 2.5rem;
    }

    .documents-title {
        color: var(--brown-highlight);
        font-size: 2rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 0.5rem;
    }

    .documents-title i {
        color: var(--primary-teal);
        font-size: 2.25rem;
    }

    .documents-subtitle {
        color: var(--dark-text);
        font-size: 0.95rem;
        margin: 0;
        opacity: 0.85;
    }

    .header-divider {
        height: 3px;
        background: linear-gradient(90deg, var(--primary-teal), var(--navbar-teal), transparent);
        border-radius: 2px;
        margin: 1rem 0 2rem 0;
    }

    /* Search & Filter Bar */
    .documents-search-bar {
        background: white;
        padding: 1.25rem;
        border-radius: 0.75rem;
        border: 1px solid rgba(108, 143, 145, 0.15);
        margin-bottom: 2rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .documents-search-input {
        border: 1px solid rgba(108, 143, 145, 0.22) !important;
        border-radius: 0.5rem !important;
        padding: 0.625rem 1rem !important;
        font-size: 0.95rem !important;
        color: var(--dark-text) !important;
        transition: all 0.3s ease;
    }

    .documents-search-input:focus {
        border-color: var(--primary-teal) !important;
        box-shadow: 0 0 0 0.25rem rgba(108, 143, 145, 0.25) !important;
    }

    /* Document Card */
    .document-card {
        background: white;
        border-radius: 0.75rem;
        border: 1px solid rgba(108, 143, 145, 0.15);
        margin-bottom: 2rem;
        overflow: hidden;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .document-card:hover {
        box-shadow: 0 8px 16px rgba(108, 143, 145, 0.15);
        border-color: var(--primary-teal);
        transform: translateY(-2px);
    }

    /* Card Header with Gradient */
    .card-header {
        padding: 1.25rem !important;
        background: linear-gradient(135deg, var(--primary-teal), var(--navbar-teal)) !important;
        color: white !important;
        border: none !important;
        display: flex;
        align-items: center;
        gap: 1rem;
        font-weight: 600;
        font-size: 1.1rem;
    }

    .card-header i {
        font-size: 1.5rem;
        opacity: 0.95;
    }

    /* Card Body */
    .document-card .card-body {
        padding: 1.5rem;
    }

    /* Document Table */
    .documents-table {
        margin: 0;
        border: none;
    }

    .documents-table thead th {
        background: linear-gradient(135deg, rgba(108, 143, 145, 0.08), rgba(123, 166, 170, 0.08));
        color: var(--dark-text);
        font-weight: 600;
        font-size: 0.95rem;
        padding: 1rem;
        border: 1px solid rgba(108, 143, 145, 0.15);
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .documents-table tbody tr {
        border-bottom: 1px solid rgba(108, 143, 145, 0.1);
        transition: background-color 0.2s ease;
    }

    .documents-table tbody tr:hover {
        background-color: rgba(108, 143, 145, 0.03);
    }

    .documents-table tbody td {
        padding: 1rem;
        color: var(--dark-text);
        vertical-align: middle;
        font-size: 0.95rem;
    }

    .documents-table tbody td i {
        margin-right: 0.5rem;
        opacity: 0.7;
    }

    /* Document Info */
    .document-date {
        color: var(--primary-teal);
        font-weight: 600;
        font-size: 0.95rem;
    }

    .document-description {
        color: var(--dark-text);
        font-size: 0.95rem;
        font-weight: 500;
    }

    .document-type-badge {
        display: inline-block;
        background: rgba(108, 143, 145, 0.1);
        color: var(--primary-teal);
        padding: 0.35rem 0.75rem;
        border-radius: 0.375rem;
        font-size: 0.85rem;
        font-weight: 600;
    }

    /* Download Button */
    .btn-download {
        background: linear-gradient(135deg, #6C8F91, #8A4F24);
        color: white !important;
        border: none;
        padding: 0.525rem 1rem;
        border-radius: 0.375rem;
        font-weight: 600;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
    }

    .btn-download:hover {
        background: linear-gradient(135deg, #8A4F24, #6C8F91);
        box-shadow: 0 4px 12px rgba(108, 143, 145, 0.25);
        color: white;
        transform: translateY(-1px);
    }

    .btn-download:active {
        transform: translateY(0);
    }

    /* Empty State */
    .empty-state {
        background: white;
        border: 2px dashed rgba(108, 143, 145, 0.25);
        border-radius: 1rem;
        padding: 3.5rem 2rem;
        text-align: center;
        margin-bottom: 2rem;
    }

    .empty-state-icon {
        font-size: 4.5rem;
        color: var(--primary-teal);
        margin-bottom: 1rem;
        opacity: 0.3;
    }

    .empty-state-title {
        font-size: 1.5rem;
        color: var(--brown-highlight);
        font-weight: 700;
        margin-bottom: 0.75rem;
    }

    .empty-state-description {
        color: var(--dark-text);
        font-size: 1rem;
        opacity: 0.75;
        margin: 0;
        line-height: 1.6;
    }

    /* No Data Message */
    .no-documents-message {
        text-align: center;
        padding: 2.5rem;
        color: var(--dark-text);
        font-size: 0.95rem;
    }

    .no-documents-message i {
        color: var(--primary-teal);
        margin-right: 0.5rem;
        opacity: 0.7;
    }

    /* Alert Messages */
    .alert-success {
        background: linear-gradient(135deg, rgba(117, 183, 152, 0.1), rgba(117, 183, 152, 0.05));
        border: 1px solid var(--success-green);
        color: var(--dark-text);
        border-radius: 0.5rem;
        padding: 1rem 1.25rem;
        margin-bottom: 1.5rem;
    }

    .alert-danger {
        background: linear-gradient(135deg, rgba(244, 165, 165, 0.1), rgba(244, 165, 165, 0.05));
        border: 1px solid var(--danger-red);
        color: var(--dark-text);
        border-radius: 0.5rem;
        padding: 1rem 1.25rem;
        margin-bottom: 1.5rem;
    }

    .alert-close-btn {
        background: none;
        border: none;
        color: var(--dark-text);
        opacity: 0.7;
        cursor: pointer;
        font-size: 1.25rem;
        padding: 0;
        margin: -0.25rem -0.5rem 0 0;
    }

    .alert-close-btn:hover {
        opacity: 1;
    }

    /* Breadcrumb */
    .breadcrumb {
        background: transparent;
        padding: 0;
        margin-bottom: 1rem;
    }

    .breadcrumb-item {
        font-size: 0.9rem;
        color: var(--dark-text);
    }

    .breadcrumb-item.active {
        color: var(--primary-teal);
        font-weight: 600;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .documents-title {
            font-size: 1.5rem;
        }

        .documents-title i {
            font-size: 1.75rem;
        }

        .document-card {
            margin-bottom: 1.5rem;
        }

        .documents-table {
            font-size: 0.85rem;
        }

        .documents-table thead th,
        .documents-table tbody td {
            padding: 0.75rem 0.5rem;
        }

        .btn-download {
            padding: 0.5rem 0.75rem;
            font-size: 0.85rem;
        }

        .empty-state {
            padding: 2.5rem 1.5rem;
        }

        .empty-state-icon {
            font-size: 3.5rem;
        }

        .empty-state-title {
            font-size: 1.25rem;
        }
    }

    /* Document Sections */
    .documents-section {
        animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Status Indicators */
    .status-available {
        color: var(--success-green);
        font-weight: 600;
    }

    /* Month/Year Styling */
    .document-meta {
        display: flex;
        gap: 1rem;
        align-items: center;
        flex-wrap: wrap;
    }

    .document-meta-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--dark-text);
        font-size: 0.95rem;
    }

    .document-meta-label {
        font-weight: 600;
        color: var(--primary-teal);
        min-width: 50px;
    }

    /* Document Card Special Styles */
    .offer-letters-header {
        background: linear-gradient(135deg, #6C8F91, #7BA6AA) !important;
    }

    .appraisal-letters-header {
        background: linear-gradient(135deg, #75B798, #8A9D84) !important;
    }

    .salary-slips-header {
        background: linear-gradient(135deg, #6C8F91, #8A4F24) !important;
    }

    .other-documents-header {
        background: linear-gradient(135deg, #A5C2C4, #7BA6AA) !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid documents-container">
    <!-- Header Section -->
    <div class="row">
        <div class="col-12">
            <div class="documents-header">
                <div class="documents-title">
                    <i class="fas fa-file-archive"></i>
                    My Documents
                </div>
                <p class="documents-subtitle">Access your important HR documents, certificates, and records</p>
                <div class="header-divider"></div>
            </div>
        </div>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div class="row">
                <div class="col-12">
                    <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show" role="alert">
                        <i class="fas fa-{{ 'exclamation-circle' if category == 'error' else 'check-circle' }} me-2"></i>
                        {{ message }}
                        <button type="button" class="alert-close-btn" data-bs-dismiss="alert" aria-label="Close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Search & Filter Bar -->
    {% if offer_letters or appraisal_letters or salary_slips or other_documents %}
    <div class="row">
        <div class="col-12">
            <div class="documents-search-bar">
                <div class="input-group">
                    <span class="input-group-text" style="background: white; border: 1px solid rgba(108, 143, 145, 0.22);">
                        <i class="fas fa-search" style="color: var(--primary-teal);"></i>
                    </span>
                    <input type="text" class="form-control documents-search-input" 
                           placeholder="Search documents..." id="documentSearch">
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Offer Letters Section -->
    <div class="row documents-section">
        <div class="col-12">
            <div class="document-card">
                <div class="card-header offer-letters-header">
                    <i class="fas fa-file-contract"></i>
                    <span>Offer Letters</span>
                </div>
                <div class="card-body">
                    {% if offer_letters %}
                    <div class="table-responsive">
                        <table class="table documents-table mb-0">
                            <thead>
                                <tr>
                                    <th>Issue Date</th>
                                    <th>Description</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for doc in offer_letters %}
                                <tr>
                                    <td>
                                        <span class="document-date">
                                            <i class="fas fa-calendar-alt"></i>
                                            {{ doc.issue_date.strftime('%d %b %Y') if doc.issue_date else '-' }}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="document-description">{{ doc.description if doc.description else 'Offer Letter' }}</span>
                                    </td>
                                    <td>
                                        <a href="{{ url_for('download_document', document_id=doc.id) }}" 
                                           class="btn-download">
                                            <i class="fas fa-download"></i>Download
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="no-documents-message">
                        <i class="fas fa-info-circle"></i>
                        <span>No offer letters available.</span>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Appraisal Letters Section -->
    <div class="row documents-section">
        <div class="col-12">
            <div class="document-card">
                <div class="card-header appraisal-letters-header">
                    <i class="fas fa-award"></i>
                    <span>Appraisal Letters</span>
                </div>
                <div class="card-body">
                    {% if appraisal_letters %}
                    <div class="table-responsive">
                        <table class="table documents-table mb-0">
                            <thead>
                                <tr>
                                    <th>Issue Date</th>
                                    <th>Description</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for doc in appraisal_letters %}
                                <tr>
                                    <td>
                                        <span class="document-date">
                                            <i class="fas fa-calendar-alt"></i>
                                            {{ doc.issue_date.strftime('%d %b %Y') if doc.issue_date else '-' }}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="document-description">{{ doc.description if doc.description else 'Appraisal Letter' }}</span>
                                    </td>
                                    <td>
                                        <a href="{{ url_for('download_document', document_id=doc.id) }}" 
                                           class="btn-download">
                                            <i class="fas fa-download"></i>Download
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="no-documents-message">
                        <i class="fas fa-info-circle"></i>
                        <span>No appraisal letters available.</span>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Salary Slips Section -->
    <div class="row documents-section">
        <div class="col-12">
            <div class="document-card">
                <div class="card-header salary-slips-header">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>Salary Slips</span>
                </div>
                <div class="card-body">
                    {% if salary_slips %}
                    <div class="table-responsive">
                        <table class="table documents-table mb-0">
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th>Year</th>
                                    <th>Description</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for doc in salary_slips %}
                                <tr>
                                    <td>
                                        <div class="document-meta-item">
                                            <i class="fas fa-calendar" style="color: var(--primary-teal);"></i>
                                            <span>
                                                {% if doc.month %}
                                                    {{ ['', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 
                                                        'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][doc.month] }}
                                                {% else %}
                                                    -
                                                {% endif %}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="document-description">{{ doc.year if doc.year else '-' }}</span>
                                    </td>
                                    <td>
                                        <span class="document-description">{{ doc.description if doc.description else 'Salary Slip' }}</span>
                                    </td>
                                    <td>
                                        <a href="{{ url_for('download_document', document_id=doc.id) }}" 
                                           class="btn-download">
                                            <i class="fas fa-download"></i>Download
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="no-documents-message">
                        <i class="fas fa-info-circle"></i>
                        <span>No salary slips available.</span>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Other Documents Section -->
    {% if other_documents %}
    <div class="row documents-section">
        <div class="col-12">
            <div class="document-card">
                <div class="card-header other-documents-header">
                    <i class="fas fa-file-alt"></i>
                    <span>Other Documents</span>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table documents-table mb-0">
                            <thead>
                                <tr>
                                    <th>Document Type</th>
                                    <th>Issue Date</th>
                                    <th>Description</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for doc in other_documents %}
                                <tr>
                                    <td>
                                        <span class="document-type-badge">
                                            <i class="fas fa-tag"></i>{{ doc.document_type }}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="document-date">
                                            <i class="fas fa-calendar-alt"></i>
                                            {{ doc.issue_date.strftime('%d %b %Y') if doc.issue_date else '-' }}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="document-description">{{ doc.description if doc.description else '-' }}</span>
                                    </td>
                                    <td>
                                        <a href="{{ url_for('download_document', document_id=doc.id) }}" 
                                           class="btn-download">
                                            <i class="fas fa-download"></i>Download
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Empty State (if no documents at all) -->
    {% if not offer_letters and not appraisal_letters and not salary_slips and not other_documents %}
    <div class="row">
        <div class="col-12">
            <div class="empty-state">
                <div class="empty-state-icon">
                    <i class="fas fa-folder-open"></i>
                </div>
                <h5 class="empty-state-title">No Documents Available</h5>
                <p class="empty-state-description">
                    Your documents will appear here once they are uploaded by HR.<br>
                    <small style="opacity: 0.7;">Check back soon!</small>
                </p>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- JavaScript for Search Functionality -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('documentSearch');
    if (searchInput) {
        searchInput.addEventListener('keyup', function() {
            const searchTerm = this.value.toLowerCase();
            const tables = document.querySelectorAll('.documents-table');
            
            tables.forEach(table => {
                const rows = table.querySelectorAll('tbody tr');
                let hasVisibleRows = false;
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    if (text.includes(searchTerm)) {
                        row.style.display = '';
                        hasVisibleRows = true;
                    } else {
                        row.style.display = 'none';
                    }
                });
                
                // Hide card if no results
                const card = table.closest('.document-card');
                if (card) {
                    card.style.display = hasVisibleRows || searchTerm === '' ? '' : 'none';
                }
            });
        });
    }
});
</script>
{% endblock %}