{% extends "base.html" %}

{% block title %}My Profile - TalaTalent{% endblock %}

{% block content %}
<div class="container-fluid profile-page-hr">
    <div class="row g-4 justify-content-center">
        <!-- Profile Sidebar -->
        <div class="col-lg-4 col-md-5">
            <div class="card profile-card shadow-sm mb-4">
                <div class="card-body text-center">
                    <div class="profile-image-frame mx-auto mb-3 position-relative">
                        <div class="profile-image-container">
                            {% if hasattr(current_user, 'employee_profile') and current_user.employee_profile and current_user.employee_profile.profile_image_path %}
                                <img src="{{ url_for('static', filename=current_user.employee_profile.profile_image_path) }}" alt="Profile Photo">
                            {% else %}
                                <div class="d-flex align-items-center justify-content-center w-100 h-100 bg-light">
                                    <i class="fas fa-user fa-4x text-muted"></i>
                                </div>
                            {% endif %}
                        </div>
                        <button class="btn btn-sm btn-light profile-edit-photo" title="Change Photo" onclick="document.getElementById('profileImageInput').click()">
                            <i class="fas fa-camera"></i>
                        </button>
                        <form id="profileImageForm" method="POST" enctype="multipart/form-data" style="display: none;">
                            <input type="file" id="profileImageInput" name="profile_image" accept="image/*" onchange="this.form.submit()">
                        </form>
                    </div>
                    <h2 class="profile-name mb-1">{{ current_user.first_name }} {{ current_user.last_name }}</h2>
                    <div class="profile-position text-muted mb-2">{{ current_user.position }}</div>
                    <div class="d-flex justify-content-center gap-2 mb-3 flex-wrap">
                        {% if current_user.department %}
                        <span class="badge profile-badge bg-primary">{{ current_user.department }}</span>
                        {% endif %}
                        {% if current_user.employment_type %}
                        <span class="badge profile-badge bg-secondary">{{ current_user.employment_type }}</span>
                        {% endif %}
                    </div>
                    <a href="{{ url_for('profile_edit') }}" class="btn btn-outline-primary w-100 mb-2">
                        <i class="fas fa-edit me-1"></i>Edit Profile
                    </a>
                </div>
            </div>
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white">
                    <strong><i class="fas fa-chart-bar me-2"></i>Quick Stats</strong>
                </div>
                <div class="card-body p-3">
                    <div class="row text-center g-2">
                        <div class="col-6">
                            <div class="stat-value">{{ stats.attendance_rate if stats else '0' }}%</div>
                            <div class="stat-label">Attendance</div>
                        </div>
                        <div class="col-6">
                            <div class="stat-value">{{ stats.leave_balance if stats else '0' }}</div>
                            <div class="stat-label">Leave Balance</div>
                        </div>
                        <div class="col-6">
                            <div class="stat-value">{{ stats.pending_claims if stats else '0' }}</div>
                            <div class="stat-label">Pending Claims</div>
                        </div>
                        <div class="col-6">
                            <div class="stat-value">{{ stats.completed_tasks if stats else '0' }}</div>
                            <div class="stat-label">Tasks Done</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Profile Main Info -->
        <div class="col-lg-8 col-md-7">
            <div class="row g-4">
                <div class="col-12">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-white">
                            <strong><i class="fas fa-id-card me-2"></i>Contact & Personal Info</strong>
                        </div>
                        <div class="card-body p-3">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="text-muted"><i class="fas fa-envelope me-2"></i>Email</label>
                                    <div>{{ current_user.email }}</div>
                                </div>
                                <div class="col-md-6">
                                    <label class="text-muted"><i class="fas fa-phone me-2"></i>Phone</label>
                                    <div>{{ current_user.phone or 'Not set' }}</div>
                                </div>
                                <div class="col-md-6">
                                    <label class="text-muted"><i class="fas fa-map-marker-alt me-2"></i>Address</label>
                                    <div>{{ current_user.address or 'Not set' }}</div>
                                </div>
                                <div class="col-md-6">
                                    <label class="text-muted"><i class="fas fa-calendar me-2"></i>Joined Date</label>
                                    <div>{{ current_user.join_date.strftime('%d %B %Y') if current_user.join_date else 'Not set' }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-white">
                            <strong><i class="fas fa-briefcase me-2"></i>Employment Details</strong>
                        </div>
                        <div class="card-body p-3">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="text-muted">Employee ID</label>
                                    <div><code>{{ current_user.employee_id }}</code></div>
                                </div>
                                <div class="col-md-6">
                                    <label class="text-muted">Position</label>
                                    <div>{{ current_user.position }}</div>
                                </div>
                                <div class="col-md-6">
                                    <label class="text-muted">Department</label>
                                    <div>{{ current_user.department or '-' }}</div>
                                </div>
                                <div class="col-md-6">
                                    <label class="text-muted">Employment Type</label>
                                    <div>{{ current_user.employment_type or '-' }}</div>
                                </div>
                                <div class="col-md-6">
                                    <label class="text-muted">Manager</label>
                                    <div>{{ current_user.manager_name or '-' }}</div>
                                </div>
                                <div class="col-md-6">
                                    <label class="text-muted">Status</label>
                                    <div>{% if current_user.is_active %}<span class="badge bg-success">Active</span>{% else %}<span class="badge bg-danger">Inactive</span>{% endif %}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-white">
                            <strong><i class="fas fa-history me-2"></i>Recent Activity</strong>
                        </div>
                        <div class="card-body p-3">
                            <div class="timeline">
                                {% for activity in activities %}
                                <div class="timeline-item mb-4">
                                    <div class="d-flex">
                                        <div class="timeline-icon me-3">
                                            <span class="badge rounded-circle bg-{{ activity.color }} p-2">
                                                <i class="fas {{ activity.icon }}"></i>
                                            </span>
                                        </div>
                                        <div class="timeline-content">
                                            <div class="mb-0">{{ activity.message }}</div>
                                            <small class="text-muted">{{ activity.time }}</small>
                                        </div>
                                    </div>
                                </div>
                                {% else %}
                                <div class="text-center py-4">
                                    <i class="fas fa-stream fa-2x text-muted mb-2"></i>
                                    <p class="text-muted mb-0">No recent activity</p>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Profile Page Styling */
.profile-page-hr {
    background-color: #f8f9fa;
    padding: 2rem 0;
}

.profile-card {
    border: none;
    border-radius: 0.5rem;
    overflow: hidden;
}

.profile-image-frame {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    overflow: hidden;
    border: 2px solid #007bff;
}

.profile-image-container {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.profile-image-container img {
    width: 100%;
    height: auto;
    object-fit: cover;
}

.profile-edit-photo {
    position: absolute;
    bottom: 0.5rem;
    right: 0.5rem;
    background-color: #ffffff;
    border: 2px solid #007bff;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.3s;
}

.profile-edit-photo:hover {
    background-color: #007bff;
    color: #ffffff;
}

.profile-name {
    font-size: 1.5rem;
    font-weight: 600;
}

.profile-position {
    font-size: 1rem;
    font-weight: 400;
}

.profile-badge {
    font-size: 0.875rem;
    font-weight: 500;
    padding: 0.375rem 0.75rem;
}

.stat-value {
    font-size: 1.25rem;
    font-weight: 500;
}

.stat-label {
    font-size: 0.875rem;
    font-weight: 400;
}

.timeline {
    position: relative;
    padding-left: 1rem;
}

.timeline-item {
    position: relative;
}

.timeline-item:not(:last-child)::after {
    content: '';
    position: absolute;
    left: 1rem;
    top: 2rem;
    bottom: -1rem;
    width: 2px;
    background-color: #e9ecef;
}

.timeline-icon {
    position: relative;
    z-index: 1;
}

.card-header {
    background-color: #ffffff;
    border-bottom: 1px solid #e9ecef;
}

.card-body {
    padding: 1.5rem;
}

.nav-tabs .nav-link {
    color: var(--text-primary);
    border: none;
    padding: 1rem 1.5rem;
    font-weight: 500;
}

.nav-tabs .nav-link.active {
    color: var(--primary);
    border-bottom: 2px solid var(--primary);
}

.profile-image-container img {
    transition: transform 0.3s ease;
}

.profile-image-container:hover img {
    transform: scale(1.05);
}
</style>

<script>
// Profile image preview
document.getElementById('profileImageInput')?.addEventListener('change', function(e) {
    if (this.files && this.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.querySelector('.profile-image-container img');
            if (preview) {
                preview.src = e.target.result;
            }
        };
        reader.readAsDataURL(this.files[0]);
    }
});
</script>
{% endblock %}