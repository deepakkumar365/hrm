{% extends "base.html" %}

{% block title %}Generate Payroll - HR Manager{% endblock %}

{% block head %}{% endblock %}

{% block content %}
<div class="payroll-container">
    <div class="payroll-header">
        <h2><i class="fas fa-file-invoice-dollar"></i> Generate Payroll</h2>
        <p>Create a new payroll run for your company</p>
    </div>

    <form method="POST" class="payroll-form">
        <div class="warning-section">
            <h4><i class="fas fa-exclamation-triangle"></i> Important</h4>
            <p>Generating payroll will process all employee salaries, deductions, and payments. Please verify all settings before proceeding.</p>
        </div>

        <div class="form-group">
            <label for="company_id">Company *</label>
            <select name="company_id" id="company_id" required>
                <option value="">-- Select Company --</option>
                {% for company in companies %}
                    <option value="{{ company.id }}">{{ company.name }}</option>
                {% endfor %}
            </select>
            <div class="help-text">Select the company for which to generate payroll</div>
        </div>

        <div class="form-group">
            <label for="month">Month *</label>
            <select name="month" id="month" required>
                <option value="">-- Select Month --</option>
                <option value="1">January</option>
                <option value="2">February</option>
                <option value="3">March</option>
                <option value="4">April</option>
                <option value="5">May</option>
                <option value="6">June</option>
                <option value="7">July</option>
                <option value="8">August</option>
                <option value="9">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
            </select>
            <div class="help-text">Select the month for payroll generation</div>
        </div>

        <div class="form-group">
            <label for="year">Year *</label>
            <select name="year" id="year" required>
                <option value="">-- Select Year --</option>
                {% for year in range(2020, 2030) %}
                    <option value="{{ year }}" {% if year == now.year %}selected{% endif %}>{{ year }}</option>
                {% endfor %}
            </select>
            <div class="help-text">Select the year for payroll generation</div>
        </div>

        <div class="info-section">
            <h4><i class="fas fa-info-circle"></i> Payroll Process</h4>
            <ul>
                <li>System will calculate base salary for all employees</li>
                <li>Overtime hours will be processed based on approved OT records</li>
                <li>Deductions (CPF, tax, etc.) will be applied automatically</li>
                <li>Final payslips will be generated and sent to employees</li>
                <li>Payment records will be created for accounting</li>
            </ul>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn-generate" id="submitBtn">
                <i class="fas fa-play"></i> Generate Payroll
            </button>
            <a href="{{ url_for('hr_manager_dashboard') }}" class="btn-cancel">
                <i class="fas fa-times"></i> Cancel
            </a>
        </div>
    </form>
</div>

<script>
    document.querySelector('form').addEventListener('submit', function(e) {
        const company = document.getElementById('company_id').value;
        const month = document.getElementById('month').value;
        const year = document.getElementById('year').value;

        if (!company || !month || !year) {
            e.preventDefault();
            alert('Please fill in all required fields');
            return false;
        }

        if (!confirm('Are you sure you want to generate payroll for ' + month + '/' + year + '?\n\nThis will process payments for all employees in the selected company.')) {
            e.preventDefault();
            return false;
        }

        document.getElementById('submitBtn').disabled = true;
        document.getElementById('submitBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
    });

    // Set current month/year by default
    const today = new Date();
    document.getElementById('month').value = today.getMonth() + 1;
    document.getElementById('year').value = today.getFullYear();
</script>
{% endblock %}