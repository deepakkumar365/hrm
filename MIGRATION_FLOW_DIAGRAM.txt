================================================================================
                    DATABASE MIGRATION AUTO-RUN FLOW DIAGRAM
================================================================================

APPLICATION STARTUP FLOW:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                         APP STARTS (main.py)                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                    Check: FLASK_SKIP_DB_INIT = '1' ?                      â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  YES                â”‚                  NO
                   â”‚                 â”‚                   â”‚
                   â†“                 â”‚                   â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ SKIP INIT  â”‚           â”‚       â”‚ Call:                â”‚
            â”‚ (no action)â”‚           â”‚       â”‚ check_and_run_       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚       â”‚ migrations()         â”‚
                   â”‚                 â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                 â”‚                   â”‚
                   â”‚                 â”‚                   â†“
                   â”‚                 â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚                 â”‚       â”‚                              â”‚
                   â”‚                 â”‚       â”‚ Check: Already run?          â”‚
                   â”‚                 â”‚       â”‚ (_migrations_applied=True)  â”‚
                   â”‚                 â”‚       â”‚                              â”‚
                   â”‚                 â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                 â”‚                   â”‚
                   â”‚                 â”‚      YES          â”‚      NO
                   â”‚                 â”‚       â”‚           â”‚       â”‚
                   â”‚                 â”‚       â†“           â†“       â”‚
                   â”‚                 â”‚     RETURN    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
                   â”‚                 â”‚              â”‚ Set flag  â”‚â”‚
                   â”‚                 â”‚              â”‚_migr=Trueâ”‚â”‚
                   â”‚                 â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
                   â”‚                 â”‚                          â”‚
                   â”‚                 â”‚                          â†“
                   â”‚                 â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚                 â”‚         â”‚                             â”‚
                   â”‚                 â”‚         â”‚ Check DB Connection         â”‚
                   â”‚                 â”‚         â”‚                             â”‚
                   â”‚                 â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                 â”‚                          â”‚
                   â”‚                 â”‚                    âœ… Connected
                   â”‚                 â”‚                          â”‚
                   â”‚                 â”‚                          â†“
                   â”‚                 â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚                 â”‚    â”‚                                    â”‚
                   â”‚                 â”‚    â”‚ Check: Tables exist?               â”‚
                   â”‚                 â”‚    â”‚ - hrm_users                        â”‚
                   â”‚                 â”‚    â”‚ - hrm_employees                    â”‚
                   â”‚                 â”‚    â”‚ - hrm_roles                        â”‚
                   â”‚                 â”‚    â”‚                                    â”‚
                   â”‚                 â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                 â”‚                         â”‚
                   â”‚           YES   â”‚       NO               â”‚
                   â”‚            â”‚    â”‚        â”‚                â”‚
                   â”‚            â†“    â”‚        â†“                â”‚
                   â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚      â”‚SKIP    â”‚ â”‚   â”‚                           â”‚
                   â”‚      â”‚MIGRATIONâ”‚ â”‚   â”‚ Check: AUTO_MIGRATE_     â”‚
                   â”‚      â”‚(logged)  â”‚ â”‚   â”‚ ON_STARTUP = true?       â”‚
                   â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚   â”‚                           â”‚
                   â”‚           â”‚      â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚           â”‚      â”‚ â”‚                   â”‚
                   â”‚           â”‚      â”‚ â”‚         YES       â”‚       NO
                   â”‚           â”‚      â”‚ â”‚          â”‚        â”‚        â”‚
                   â”‚           â”‚      â”‚ â”‚          â†“        â”‚        â†“
                   â”‚           â”‚      â”‚ â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚           â”‚      â”‚ â”‚    â”‚ RUN     â”‚   â”‚   â”‚ SKIP     â”‚
                   â”‚           â”‚      â”‚ â”‚    â”‚ MIGRATE â”‚   â”‚   â”‚ (warn)   â”‚
                   â”‚           â”‚      â”‚ â”‚    â”‚ (upgrade)   â”‚   â”‚ (logged) â”‚
                   â”‚           â”‚      â”‚ â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚           â”‚      â”‚ â”‚         â”‚        â”‚        â”‚
                   â”‚           â”‚      â”‚ â”‚      âœ… Success  â”‚        â”‚
                   â”‚           â”‚      â”‚ â”‚         â”‚        â”‚        â”‚
                   â”‚           â”‚      â”‚ â”‚         â†“        â”‚        â”‚
                   â”‚           â”‚      â”‚ â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚        â”‚
                   â”‚           â”‚      â”‚ â”‚    â”‚ TABLES  â”‚   â”‚        â”‚
                   â”‚           â”‚      â”‚ â”‚    â”‚ CREATED â”‚   â”‚        â”‚
                   â”‚           â”‚      â”‚ â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â”‚        â”‚
                   â”‚           â”‚      â”‚ â”‚         â”‚        â”‚        â”‚
                   â”‚           â”‚      â””â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚           â”‚                  â”‚
                   â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                  â”‚
                   â”‚                  â†“
                   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚    â”‚                          â”‚
                   â”‚    â”‚ Call:                    â”‚
                   â”‚    â”‚ initialize_default_data()â”‚
                   â”‚    â”‚                          â”‚
                   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚               â”‚
                   â”‚               â†“
                   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚    â”‚                          â”‚
                   â”‚    â”‚ Check: Tables exist?     â”‚
                   â”‚    â”‚                          â”‚
                   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚               â”‚
                   â”‚    âœ… YES     â”‚     âŒ NO
                   â”‚     â”‚         â”‚       â”‚
                   â”‚     â†“         â”‚       â†“
                   â”‚  â”Œâ”€â”€â”€â”€â”€â”     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  â”‚ INITâ”‚     â”‚  â”‚ SKIP    â”‚
                   â”‚  â”‚DATA â”‚     â”‚  â”‚ (warn)  â”‚
                   â”‚  â””â”€â”€â”¬â”€â”€â”˜     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚     â”‚        â”‚       â”‚
                   â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                              â”‚
          â”‚ âœ… APP READY FOR USE        â”‚
          â”‚                              â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


DECISION TREE - WHAT HAPPENS BASED ON CONDITIONS:

                                     START
                                      â”‚
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚                         â”‚
                  FLASK_SKIP_DB_INIT=1?           â”‚
                 YES â†“                NO â†“         â”‚
                 â”‚                     â”‚           â”‚
              SKIP ALL              Check Tables  â”‚
                 â”‚                     â”‚           â”‚
                 â””â”€â†’ Continue   âœ… EXIST â”€â”        â”‚
                     (no action)         â”‚        â”‚
                                   âŒ MISSING     â”‚
                                    â”‚            â”‚
                            AUTO_MIGRATE=true?   â”‚
                            YES â†“  NO â†“          â”‚
                            â”‚      â”‚             â”‚
                        RUN MIGRATE SKIP         â”‚
                        â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                        â†“                    â†“   â†“
                   Initialize Default Data â”€â”
                        â”‚                   â”‚
                        â†“                   â†“
                   All Done - App Ready!
                   âœ… SUCCESSFUL STARTUP


MESSAGE FLOW - WHAT GETS LOGGED:

SCENARIO 1: First Run (No Tables, AUTO_MIGRATE=true)
  
  ğŸ“¦ Database tables not found. Running migrations...
  ğŸ”„ Applying migration: [migration_name] ...
  âœ… Migrations completed successfully!
  âœ… Default users created successfully!
  âœ… Default master data created successfully!
  â†’ App starts normally


SCENARIO 2: Normal Run (Tables Exist)

  âœ… Database tables exist - skipping migrations
  âœ… Default users created successfully!
  âœ… Default master data created successfully!
  â†’ App starts normally


SCENARIO 3: Missing Tables, AUTO_MIGRATE=false

  âš ï¸  Database tables not found.
     To auto-run migrations on startup, set: AUTO_MIGRATE_ON_STARTUP=true
     Otherwise, run manually: flask db upgrade
  â†’ App may have limited functionality


SCENARIO 4: Migration Error

  ğŸ“¦ Database tables not found. Running migrations...
  âŒ Migration failed: [error_details]
  â†’ App startup fails - manual intervention needed


STATE MACHINE - TABLE EXISTENCE STATES:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INITIAL STATE                         â”‚
â”‚         No database tables exist                         â”‚
â”‚     (hrm_users, hrm_employees, hrm_roles missing)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                       â”‚
        AUTO_MIGRATE=true       AUTO_MIGRATE=false
                â”‚                       â”‚
                â†“                       â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ RUNNING      â”‚         â”‚ WAITING     â”‚
        â”‚ MIGRATION    â”‚         â”‚ FOR MANUAL  â”‚
        â”‚              â”‚         â”‚ UPGRADE     â”‚
        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        Migration succeeds
               â”‚
               â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ TABLES EXIST â”‚
        â”‚ APP READY    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


DEPLOYMENT FLOW - DIFFERENT ENVIRONMENTS:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DEVELOPMENT                              â”‚
â”‚  AUTO_MIGRATE_ON_STARTUP=true                               â”‚
â”‚  Tables auto-create on restart                              â”‚
â”‚  Developer-friendly                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DOCKER/CONTAINER                           â”‚
â”‚  AUTO_MIGRATE_ON_STARTUP=true                               â”‚
â”‚  Tables auto-create on container start                      â”‚
â”‚  First deployment: tables created automatically             â”‚
â”‚  Subsequent: skip migration, app ready                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            PRODUCTION (Single Instance)                      â”‚
â”‚  AUTO_MIGRATE_ON_STARTUP=true                               â”‚
â”‚  Tables auto-create on deployment                           â”‚
â”‚  Simple deployment process                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       PRODUCTION (High Availability / Multiple Instances)    â”‚
â”‚  AUTO_MIGRATE_ON_STARTUP=false                              â”‚
â”‚  Manual: flask db upgrade (before deployment)               â”‚
â”‚  All instances start normally (no concurrent migrations)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ERROR HANDLING FLOW:

Database Connection Error
          â†“
   âŒ Cannot Connect
          â†“
   Log: "Error checking database tables"
          â†“
   App startup fails (fail-fast)
          â†“
   Admin must fix database connectivity

---

Migration Syntax Error
          â†“
   Running: flask db upgrade
          â†“
   âŒ Migration Failed
          â†“
   Log: "Migration failed: [error]"
          â†“
   App startup fails (fail-fast)
          â†“
   Admin must fix migration file

---

Missing Tables + AUTO_MIGRATE=false
          â†“
   âš ï¸  Log warning
          â†“
   App continues (reduced functionality)
          â†“
   Admin runs: flask db upgrade
          â†“
   Restart app


CONTROL FLOW - ONE-TIME EXECUTION:

_migrations_applied = False (global flag)

First Call to check_and_run_migrations():
  1. Check: if _migrations_applied == False  âœ… (True)
  2. Set: _migrations_applied = True
  3. Check tables
  4. Run migrations (if needed)
  5. Return result

Subsequent Calls (if any):
  1. Check: if _migrations_applied == False  âœ… (False)
  2. Return immediately (skip execution)
  3. No duplicate migrations

Result: Only runs once per app startup!


ENVIRONMENT VARIABLE CONTROL:

                        STARTUP
                          â”‚
                          â†“
          Read: AUTO_MIGRATE_ON_STARTUP env var
                          â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                   â”‚
         "true"/"1"/"yes"    anything else
                â”‚                   â”‚
                â†“                   â†“
        AUTO-MIGRATE        SKIP AUTO-MIGRATE
        (if needed)         (manual control)
                â”‚                   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                       CONTINUE


================================================================================
                       SUMMARY OF KEY CONCEPTS
================================================================================

âœ… SAFE EXECUTION:
   - One-time per startup (global flag)
   - Only if tables missing (existence check)
   - Proper error handling (fail-fast)
   - Clear logging (success/error/warning messages)

âœ… ENVIRONMENT CONTROL:
   - AUTO_MIGRATE_ON_STARTUP true/false
   - Different behavior per environment
   - Easy to adjust deployment strategy

âœ… BACKWARD COMPATIBLE:
   - Existing code still works
   - Existing migrations still work
   - Optional feature (can disable)

âœ… DEVELOPER FRIENDLY:
   - Auto-runs in development
   - No manual steps in dev environment
   - Clear error messages if problems

================================================================================

For more details, see:
  ğŸ“„ QUICK_START_DB_MIGRATION.md
  ğŸ“„ docs/DATABASE_MIGRATION_AUTO_RUN.md
  ğŸ“„ IMPLEMENTATION_SUMMARY_DB_MIGRATION.md

================================================================================