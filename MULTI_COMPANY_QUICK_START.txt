â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                            â•‘
â•‘              ğŸ¢ MULTI-COMPANY USER MANAGEMENT - QUICK START                â•‘
â•‘                                                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


ğŸ“Œ WHAT IS THIS?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Users can now belong to MULTIPLE companies in a single system.
Example: HR Manager "john_smith" can manage employees in:
  â€¢ Company A (Main Office)
  â€¢ Company B (Branch Office)
  â€¢ Company C (Regional HQ)

This is managed through the UserCompanyAccess junction table.


ğŸš€ 3 WAYS TO ADD COMPANIES TO USERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OPTION 1: INTERACTIVE SCRIPT (Easiest - Start Here!)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤

Run:
  $ python setup_user_companies.py

Menu:
  1. View all users
  2. View all companies
  3. View companies for a user
  4. Add company to user â† Use this
  5. Remove company from user
  6. Bulk add (all to all)
  7. Summary statistics

âœ… Best for: Testing, single operations, visual interface
â±ï¸  Time: 2 minutes

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OPTION 2: PYTHON SCRIPT (For Automation/Scripting)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤

File: add_user_companies.py

Examples:

  # Add single company to user
  from add_user_companies import add_company_to_user
  add_company_to_user(user_id=1, company_id='uuid-xxx')

  # Add multiple companies
  from add_user_companies import add_companies_to_user
  company_ids = ['uuid-1', 'uuid-2', 'uuid-3']
  add_companies_to_user(user_id=1, company_ids=company_ids)

  # List user's companies
  from add_user_companies import list_user_companies
  list_user_companies(user_id=1)

  # Remove company
  from add_user_companies import remove_company_from_user
  remove_company_from_user(user_id=1, company_id='uuid-xxx')

âœ… Best for: Batch operations, integration, automation
â±ï¸  Time: 5 minutes setup

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OPTION 3: WEB UI (For End-User Management)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤

See: ADD_COMPANIES_TO_USERS_GUIDE.md (Method 3)

Location after setup:
  /manage-user-companies

Features:
  âœ“ Select user from dropdown
  âœ“ View current companies
  âœ“ Add/remove companies with one click
  âœ“ No technical knowledge needed

âœ… Best for: Production use, admin interface, end users
â±ï¸  Time: 15 minutes implementation

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


ğŸ“Š DATABASE STRUCTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Table: hrm_user_company_access
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id (UUID)                                    â”‚ â† Unique ID
â”‚ user_id (FK â†’ hrm_users.id)                  â”‚ â† Which user
â”‚ company_id (FK â†’ hrm_company.id)             â”‚ â† Which company
â”‚ created_at (timestamp)                       â”‚ â† When added
â”‚ modified_at (timestamp)                      â”‚ â† When updated
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Constraints:
  â€¢ UNIQUE (user_id, company_id) â† Can't add same company twice to user
  â€¢ Indexes on both user_id and company_id for fast queries
  â€¢ CASCADE delete â† If user or company deleted, access removed


âœ… INITIAL SETUP (Do This First!)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Step 1: Apply database migration
  $ flask db upgrade

Step 2: Populate existing relationships
  $ python migrate_user_company_access.py

Step 3: Verify it worked
  $ python setup_user_companies.py
  â†’ Select option 7 (Summary statistics)


ğŸ” QUICK CHECKS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Check if user has access to specific company
python -c "
from app import app
from models import User, UserCompanyAccess

with app.app_context():
    user = User.query.filter_by(username='john_smith').first()
    companies = [a.company.name for a in user.company_access]
    print(f'john_smith has access to: {companies}')
"

# Count total relationships
python -c "
from app import app
from models import UserCompanyAccess

with app.app_context():
    total = UserCompanyAccess.query.count()
    print(f'Total user-company relationships: {total}')
"

# List all users with multi-company access
python -c "
from app import app
from models import User, UserCompanyAccess
from sqlalchemy import func

with app.app_context():
    multi = (User.query
        .join(UserCompanyAccess)
        .group_by(User.id)
        .having(func.count(UserCompanyAccess.id) > 1)
        .all())
    for u in multi:
        count = len(u.company_access)
        print(f'{u.username}: {count} companies')
"


ğŸ’¡ COMMON USE CASES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. HR Manager managing multiple branches
   User: hr_manager_1
   Companies: Branch_A, Branch_B, Branch_C

2. Super Admin with access to all companies
   User: admin
   Companies: All companies (automatic, see migrate script)

3. Finance Manager for specific regions
   User: finance_manager_1
   Companies: Region_North_Company, Region_North_Branch

4. Employee with single company
   User: emp_001
   Companies: Company_A (default, from employee profile)


ğŸ¯ EXAMPLE WORKFLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Scenario: Add HR Manager "sarah" to manage both NYC and LA offices

1. Run: python setup_user_companies.py
   Option 1 â†’ View all users â†’ Find sarah (ID: 5)
   Option 2 â†’ View all companies â†’ Find NYC (UUID: xxx), LA (UUID: yyy)

2. Option 4 â†’ Add company to user
   Select user: 1 (sarah)
   Select companies: 1, 2 (NYC and LA)
   â†’ Done! âœ…

3. Verify: Option 3 â†’ View companies for user
   â†’ Shows: sarah has access to NYC and LA âœ“


âš™ï¸  TECHNICAL DETAILS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Model Definition (models.py):

  class UserCompanyAccess(db.Model):
      __tablename__ = 'hrm_user_company_access'
      
      id = db.Column(UUID, primary_key=True)
      user_id = db.Column(Integer, FK)       # Links to User
      company_id = db.Column(UUID, FK)       # Links to Company
      created_at = db.Column(DateTime)
      modified_at = db.Column(DateTime)

User Model Extension (models.py):

  class User:
      company_access = db.relationship('UserCompanyAccess', ...)
      # Access via: user.company_access â†’ list of UserCompanyAccess records
      # Companies: [a.company for a in user.company_access]


Query in Routes/Business Logic:

  from models import UserCompanyAccess

  # Get companies for user
  companies = [a.company for a in user.company_access]

  # Check permission
  has_access = UserCompanyAccess.query.filter_by(
      user_id=user_id,
      company_id=company_id
  ).first() is not None


ğŸ†˜ TROUBLESHOOTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Problem: "UNIQUE constraint failed"
  â†’ User already has access to this company
  â†’ Solution: Remove first or use different company

Problem: "User not found" when trying to add
  â†’ User ID doesn't exist in database
  â†’ Solution: Run "python setup_user_companies.py" â†’ Option 1 (View users)

Problem: "Company not found" when trying to add
  â†’ Company UUID is wrong
  â†’ Solution: Run "python setup_user_companies.py" â†’ Option 2 (View companies)

Problem: Script says "No users found"
  â†’ Database is empty
  â†’ Solution: Add users first, then add company relationships

Problem: Changes not showing in application
  â†’ Relationship not loading properly
  â†’ Solution: Restart Flask app: python main.py


ğŸ“š DETAILED DOCUMENTATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

For comprehensive guide with all examples:
  â†’ See: ADD_COMPANIES_TO_USERS_GUIDE.md

For troubleshooting and database queries:
  â†’ See: ADD_COMPANIES_TO_USERS_GUIDE.md (section: Database Queries)

For building the web UI:
  â†’ See: ADD_COMPANIES_TO_USERS_GUIDE.md (Method 3: Web UI)


ğŸ‰ WHAT YOU GET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Users can have multiple company access
âœ… Multi-tenant capabilities enabled
âœ… Role-based company filtering possible
âœ… Scalable for enterprise deployments
âœ… Easy to manage and audit (created_at tracking)
âœ… No breaking changes to existing code


ğŸš¦ NEXT STEPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  1. âš™ï¸  Run initial setup (Steps 1-3 above)
  
  2. ğŸ§ª Test with: python setup_user_companies.py
     â†’ Option 4: Add company to user
  
  3. âœ… Verify: Option 7: Summary statistics
     â†’ Check that relationships were created
  
  4. ğŸ¨ (Optional) Build web UI for easier management
     â†’ See: ADD_COMPANIES_TO_USERS_GUIDE.md (Method 3)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ready to get started? Run:
  python setup_user_companies.py

Then select option 4 to add your first company!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•