================================================================================
                   ğŸš€ MIGRATION QUICK START GUIDE
                      Development to Production DB
================================================================================

â±ï¸ TOTAL TIME: ~75 minutes (All steps included)

================================================================================
                         âš ï¸  CRITICAL FIRST!
================================================================================

BACKUP FIRST (This cannot be overstated):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. BACKUP PRODUCTION DATABASE (if it exists and has data):
   
   On Windows (PowerShell):
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   $env:PGPASSWORD="your_password"; 
   pg_dump -h your_host -U your_user prod_db > "C:\backups\prod_backup_$(Get-Date -f 'yyyyMMdd_HHmmss').sql"
   
   On Linux/Mac:
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   pg_dump -h your_host -U your_user prod_db > ~/backups/prod_backup_$(date +%Y%m%d_%H%M%S).sql


2. BACKUP DEVELOPMENT DATABASE (to recover if needed):
   
   On Windows (PowerShell):
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   $env:PGPASSWORD="your_password"; 
   pg_dump -h your_host -U your_user dev_db > "C:\backups\dev_backup_$(Get-Date -f 'yyyyMMdd_HHmmss').sql"
   
   On Linux/Mac:
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   pg_dump -h your_host -U your_user dev_db > ~/backups/dev_backup_$(date +%Y%m%d_%H%M%S).sql

================================================================================
                           STEP 0: VERIFICATION
                              (5 minutes)
================================================================================

Run the PRE-MIGRATION checklist to verify everything is ready:

   Windows (PowerShell):
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   cd "E:\Gobi\Pro\HRMS\hrm"
   python pre_migration_checklist.py

   Linux/Mac:
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   cd ~/path/to/hrm
   python pre_migration_checklist.py

Expected Output:
   âœ… All environment variables set
   âœ… Development database connected
   âœ… Production database connected
   âœ… Python 3.9+ installed
   âœ… All required packages present
   âœ… Migration files found
   âœ… Disk space available

If you see âŒ CRITICAL ISSUES:
   â†’ Fix them before proceeding!
   â†’ Most common: Missing DEV_DATABASE_URL or PROD_DATABASE_URL in .env

================================================================================
                           STEP 1: STOP APPLICATION
                              (2 minutes)
================================================================================

Stop all running instances:

   If running on local machine:
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Press CTRL+C in the terminal running the app

   If running as a service on Render/Cloud:
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Stop the service in your deployment dashboard
   OR: suspend the service for 30 minutes

Reason: Prevents users from making changes during migration

================================================================================
                      STEP 2: VERIFY CONNECTIVITY
                              (3 minutes)
================================================================================

Test that both databases are accessible:

   On Windows (PowerShell):
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   # Test Dev Database
   $env:PGPASSWORD="your_dev_password"; 
   psql -h your_dev_host -U your_dev_user -d dev_db -c "SELECT version();"
   
   # Test Prod Database
   $env:PGPASSWORD="your_prod_password"; 
   psql -h your_prod_host -U your_prod_user -d prod_db -c "SELECT version();"

Expected: Version information displays successfully

If connection fails:
   â†’ Check database URL in .env
   â†’ Verify database is running
   â†’ Check firewall/network access
   â†’ Contact database admin

================================================================================
                        STEP 3: RUN MIGRATION
                             (10 minutes)
================================================================================

Execute the migration script:

   Option A: FULL MIGRATION (Recommended for first time)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Windows (PowerShell):
   cd "E:\Gobi\Pro\HRMS\hrm"
   python db_migration_to_prod.py --mode full
   
   Linux/Mac:
   cd ~/path/to/hrm
   python db_migration_to_prod.py --mode full

   This does:
   âœ“ Runs Alembic schema migrations
   âœ“ Exports master data from development
   âœ“ Imports master data to production
   âœ“ Performs validation

   Expected Output:
   ğŸ”— Connecting to development database...
   âœ… Development database connected
   ğŸ”— Connecting to production database...
   âœ… Production database connected
   
   ğŸ“‹ Verifying database schemas...
   ... (more steps) ...
   
   âœ… MIGRATION COMPLETED SUCCESSFULLY


   Option B: SCHEMA ONLY (Testing/Safe)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   python db_migration_to_prod.py --mode schema-only
   
   (Use this to test if schema migration works without moving data)


   Option C: DATA ONLY (If schema already exists)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   python db_migration_to_prod.py --mode data-only


If migration fails:
   â†’ Read error message carefully
   â†’ Check connectivity again
   â†’ See TROUBLESHOOTING section below
   â†’ Restore from backup and try again

================================================================================
                        STEP 4: VERIFY MIGRATION
                              (5 minutes)
================================================================================

Run verification to confirm migration success:

   Windows (PowerShell):
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   cd "E:\Gobi\Pro\HRMS\hrm"
   python verify_prod_migration.py --quick

   Expected Output:
   âœ… Development database connected
   âœ… Production database connected
   âœ… All tables present in production
   âœ… Organizations: X records
   âœ… Roles: X records
   âœ… Designations: X records
   
   âœ… MIGRATION SUCCESSFUL

For detailed verification:
   python verify_prod_migration.py --detailed

If verification fails:
   â†’ Check error messages
   â†’ Restore backup: psql -h host -U user -d db < backup.sql
   â†’ Contact support

================================================================================
                    STEP 5: SETUP USER PASSWORDS
                              (3 minutes)
================================================================================

After migration, reset all user passwords to a known value:

   Windows (PowerShell):
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   cd "E:\Gobi\Pro\HRMS\hrm"
   python prod_password_management.py

   Choose: Option 4 (Reset ALL users)
   Enter password: Noltrion@123
   Confirm: yes

   This makes all users have the same temporary password.
   They will be forced to change it on first login.

Expected Output:
   Menu Options:
   1. List all users
   2. Verify user password
   3. Reset specific user password
   4. Reset ALL user passwords    â† SELECT THIS
   5. Export credentials to JSON
   6. Debug password

   Option chosen: 4
   Enter new password: Noltrion@123
   Confirm password: Noltrion@123
   âœ… Password reset for 8 users

================================================================================
                    STEP 6: TEST LOGIN (OPTIONAL)
                              (3 minutes)
================================================================================

Verify users can login with the new password:

   Windows (PowerShell):
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   cd "E:\Gobi\Pro\HRMS\hrm"
   python test_login_credentials.py

   Expected Output:
   Testing login credentials...
   âœ… superadmin: CAN LOGIN with password
   âœ… manager: CAN LOGIN with password
   âœ… employee: CAN LOGIN with password
   ... (more users) ...
   
   âœ… All users tested successfully

================================================================================
                    STEP 7: START APPLICATION
                              (2 minutes)
================================================================================

Start the application in production mode:

   On Local Machine:
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Windows (PowerShell):
   $env:ENVIRONMENT="production"
   python main.py

   Linux/Mac:
   export ENVIRONMENT=production
   python main.py

   On Render/Cloud:
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Re-enable/restart the service in deployment dashboard

   Expected Output:
   [INFO] Running in PRODUCTION mode
   [INFO] Starting HRMS Application...
   [INFO] Connected to database...
   * Running on https://your-app.com

   Then test:
   â†’ Go to https://your-app.com/login
   â†’ Login with: superadmin / Noltrion@123
   â†’ You should see the dashboard

================================================================================
                         âœ… SUCCESS INDICATORS
================================================================================

After migration, verify these work:

   âœ… Application starts without errors
   âœ… Can login with temporary password
   âœ… Dashboard loads and displays data
   âœ… Organizations visible in dropdown
   âœ… Designations available in forms
   âœ… Leave types configured
   âœ… Payroll module accessible
   âœ… Reports generate correctly
   âœ… All users can access their respective areas

If any of these don't work:
   â†’ Check application logs
   â†’ Verify database connectivity
   â†’ Run verify_prod_migration.py --detailed

================================================================================
                         ğŸš¨ TROUBLESHOOTING
================================================================================

PROBLEM: "Connection refused" error
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Solution:
   1. Verify database is running: psql --version
   2. Check database URL in .env: PROD_DATABASE_URL
   3. Test connection: psql $PROD_DATABASE_URL -c "SELECT 1"
   4. Check firewall/VPN if remote database

PROBLEM: "Foreign key constraint failed"
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Solution:
   1. Check data integrity: python verify_prod_migration.py --detailed
   2. May have inconsistent data in development
   3. Contact database admin if problem persists

PROBLEM: "Out of disk space" error
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Solution:
   1. Free up space on server
   2. Delete old backup files
   3. Run migration again

PROBLEM: Application won't start in production
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Solution:
   1. Check PROD_DATABASE_URL in .env
   2. Check PROD_SESSION_SECRET in .env
   3. Run: python main.py (with debug output)
   4. Check application.log file for errors

PROBLEM: Users can't login after migration
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Solution:
   1. Reset all user passwords: python prod_password_management.py
   2. Choose option 4 to reset all users
   3. Set password to: Noltrion@123
   4. Test again: python test_login_credentials.py

PROBLEM: Some data missing after migration
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Solution:
   1. Check which tables are empty: python verify_prod_migration.py --detailed
   2. Export missing data manually from dev
   3. Import into production
   4. Or restore backup and try again

================================================================================
                         ğŸ“š ADDITIONAL RESOURCES
================================================================================

Detailed Documentation:
   â€¢ MIGRATION_PREPARATION.md - Complete migration guide
   â€¢ Check logs: tail -f application.log
   â€¢ Database stats: python verify_prod_migration.py --stats

Scripts Available:
   â€¢ db_migration_to_prod.py - Main migration tool
   â€¢ verify_prod_migration.py - Verification tool
   â€¢ pre_migration_checklist.py - Pre-flight checks
   â€¢ prod_password_management.py - Password management
   â€¢ test_login_credentials.py - Test login

Support Commands:
   # Quick status
   python verify_prod_migration.py --quick
   
   # Detailed report
   python verify_prod_migration.py --detailed
   
   # Test connectivity
   python pre_migration_checklist.py

================================================================================
                              â±ï¸ TIMELINE
================================================================================

Task                          Duration      Cumulative
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Backup databases              10 min        10 min
Pre-migration checks          5 min         15 min
Stop application              2 min         17 min
Verify connectivity           3 min         20 min
Run migration                 10 min        30 min
Verify results                5 min         35 min
Setup user passwords          3 min         38 min
Test login                    3 min         41 min
Start application             2 min         43 min
Final testing                 5 min         48 min
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOTAL                                       48 min

Buffer for contingencies: +30 min
Expected total: ~75-90 minutes

================================================================================
                           âœ¨ YOU'RE READY!
================================================================================

Next Steps:
   1. Review this guide completely
   2. Run: python pre_migration_checklist.py
   3. Create backups (CRITICAL!)
   4. Execute migration
   5. Verify success
   6. Start application
   7. Test functionality

For questions or issues, refer to MIGRATION_PREPARATION.md or contact support.

Good luck! ğŸ‰

================================================================================
Last Updated: 2024
Version: 1.0
Status: READY FOR PRODUCTION MIGRATION
================================================================================